<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Samsara Saga - Journey Through Existence</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Marcellus&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Link to the external CSS files -->
    <link rel="stylesheet" href="main.css">

    <!-- Data files first -->
    <script src="ACT1storyData.js"></script>
    <script src="ACT2storyData.js"></script>
    <script src="ACT3storyData.js"></script>
    <script src="puzzles.js"></script>
    <script src="nakshatraData.js"></script>
    <script src="storyDataBridge.js"></script>
    
    <!-- Then engine components -->
    <script src="GameStateManager.js"></script>
    <script src="StoryEngine.js"></script>
    <script src="ProgressionSystem.js"></script>
    <script src="PuzzleEngine.js"></script>
    <script src="QuestSystem.js"></script>
    <script src="AudioManager.js"></script>
    <script src="UIController.js"></script>
    <script src="VisualEffects.js"></script>
    <script src="navigation.js"></script>

</head>
<body>

    <a href="#main-content" class="skip-link">Skip to content</a>

    <!-- Animated Background -->
    <div id="vignette-overlay"></div>
    <div id="particle-background"></div>


    <!-- Custom Cursor -->
    <div id="cursor-container">
        <svg class="chakra-cursor" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#e09658" stroke-width="1">
            <circle cx="12" cy="12" r="10"/>
            <g transform="translate(12,12)">
                <path d="M0,-10 L 2,-8 L 0,-6 L -2,-8 Z" transform="rotate(0)"/>
                <path d="M0,-10 L 2,-8 L 0,-6 L -2,-8 Z" transform="rotate(30)"/>                <path d="M0,-10 L 2,-8 L 0,-6 L -2,-8 Z" transform="rotate(60)"/>
                <path d="M0,-10 L 2,-8 L 0,-6 L -2,-8 Z" transform="rotate(90)"/>
                <path d="M0,-10 L 2,-8 L 0,-6 L -2,-8 Z" transform="rotate(120)"/>
                <path d="M0,-10 L 2,-8 L 0,-6 L -2,-8 Z" transform="rotate(150)"/>
                <path d="M0,-10 L 2,-8 L 0,-6 L -2,-8 Z" transform="rotate(180)"/>
                <path d="M0,-10 L 2,-8 L 0,-6 L -2,-8 Z" transform="rotate(210)"/>
                <path d="M0,-10 L 2,-8 L 0,-6 L -2,-8 Z" transform="rotate(240)"/>
                <path d="M0,-10 L 2,-8 L 0,-6 L -2,-8 Z" transform="rotate(270)"/>
                <path d="M0,-10 L 2,-8 L 0,-6 L -2,-8 Z" transform="rotate(300)"/>
                <path d="M0,-10 L 2,-8 L 0,-6 L -2,-8 Z" transform="rotate(330)"/>
            </g>
            <circle cx="12" cy="12" r="2" fill="#e09658"/>
        </svg>
    </div>

    <!-- Page Transition Effect -->
    <div class="page-transition">
        <div class="page-transition-mandala"></div>
    </div>

    <!-- Top Bar with Title and Menu -->
    <header class="game-header">
        <div class="header-title">Samsara Saga</div>
        <button class="menu-toggle-button" id="menu-button">
            <i class="fas fa-bars"></i>
            <span>Menu</span>
        </button>
    </header>

    <!-- Main wrapper for the entire game interface -->
    <div class="game-wrapper">
        <!-- Main content area for narrative and choices (Left Column) -->
        <main class="story-panel" id="main-content">
            <div id="story-container" class="section">
                <div id="story-text" class="text-fade-in">
                    <p>The cycle turns...</p>
                    <p>You find yourself at the beginning of a new journey, your past lives echoing in the chambers of your consciousness like distant whispers.</p>
                    <p>The path ahead is shrouded in mist, but your <span class="highlight-text" id="nakshatra-name">Nakshatra</span> nature guides you forward, illuminating the way with its unique light.</p>
                </div>
            </div>
            <div id="choices-container" class="text-fade-in-delay-1">
                <!-- Player choices will be dynamically inserted here -->
                <button class="choice-button">
                    <span class="choice-icon"><i class="fas fa-walking"></i></span>
                    <span class="choice-content">Begin your journey with mindful steps, observing the world around you.</span>
                </button>
                <button class="choice-button">
                    <span class="choice-icon"><i class="fas fa-eye"></i></span>
                    <span class="choice-content">Close your eyes and turn inward, seeking guidance from your inner wisdom.</span>
                </button>
                <button class="choice-button">
                    <span class="choice-icon"><i class="fas fa-comments"></i></span>
                    <span class="choice-content">Call out to see if anyone else is nearby who might offer guidance.</span>
                </button>
            </div>
        </main>
        
        <!-- Sidebar for player stats and game controls (Right Column) -->
        <aside class="status-panel">
            <div class="character-summary">
                <div class="character-symbol">
                    <svg viewBox="0 0 100 100" id="character-symbol-svg"></svg>
                </div>
                <h2 class="character-name" id="character-name">Jiva</h2>
            </div>
            
            <div class="panel-section">
                <h3 class="panel-title">Spiritual Attributes</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-label">Karma</span> 
                        <div class="stat-bar karma-bar"><div id="karma-fill" style="width: 50%;"></div></div>
                        <span id="karma-value" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Sattva</span> 
                        <div class="stat-bar sattva-bar"><div id="sattva-fill" style="width: 30%;"></div></div>
                        <span id="sattva-value" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Rajas</span> 
                        <div class="stat-bar rajas-bar"><div id="rajas-fill" style="width: 80%;"></div></div>
                        <span id="rajas-value" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Tamas</span> 
                        <div class="stat-bar tamas-bar"><div id="tamas-fill" style="width: 10%;"></div></div>
                        <span id="tamas-value" class="stat-value">0</span>
                    </div>
                </div>
            </div>
            
            <div class="panel-section">
                 <h3 class="panel-title">Elemental Affinity</h3>
                 <div class="element-display" id="element-display">
                    <!-- Populated by JS -->
                 </div>
            </div>
            
            <div class="panel-section">
                <h3 class="panel-title">Inventory</h3>
                <ul id="inventory-list">
                    <li class="inventory-empty">(Empty)</li>
                </ul>
            </div>

            <div class="game-controls">
                <button class="control-button" id="new-game-btn">
                    <i class="fas fa-sync-alt"></i> Begin Anew
                </button>
            </div>
        </aside>
    </div>

    <!-- Game Menu Modal -->
    <div class="modal" id="game-menu-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Game Menu</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="menu-buttons">
                    <button class="menu-button" id="character-profile-btn"><i class="fas fa-user"></i><span>Character Profile</span></button>
                    <button class="menu-button" id="save-game-btn"><i class="fas fa-save"></i><span>Save Game</span></button>
                    <button class="menu-button" id="load-game-btn"><i class="fas fa-folder-open"></i><span>Load Game</span></button>
                    <button class="menu-button" id="settings-btn"><i class="fas fa-cog"></i><span>Settings</span></button>
                    <button class="menu-button" id="help-btn"><i class="fas fa-question-circle"></i><span>Help</span></button>
                    <button class="menu-button" id="exit-game-btn"><i class="fas fa-sign-out-alt"></i><span>Exit to Main Menu</span></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification System -->
    <div id="notification-container"></div>

    <style>
        .skip-link { position: fixed; left: -9999px; top: 0; background: var(--color-primary); color: #0a0908; padding: 8px 12px; border-radius: 6px; z-index: 10001; }
        .skip-link:focus { left: 10px; top: 10px; box-shadow: 0 0 10px var(--color-primary-glow); }
        @media (prefers-reduced-motion: reduce) {
            * { animation-duration: 0.001s !important; animation-iteration-count: 1 !important; transition: none !important; }
            .page-transition-mandala { animation: none !important; }
            #particle-background { animation: none !important; }
        }
        /* --- Gamic UI/UX Revamp Styles --- */
        :root {
            --font-title: 'Cinzel', serif;
            --font-body: 'Marcellus', serif;
            
            --color-bg: #0a0908;
            --color-surface: #1a1817;
            --color-text: #c5c1b9;
            --color-text-muted: #7a7670;
            
            --color-primary: #e09658;
            --color-primary-glow: #ffc994;
            --color-shadow: #e09658;

            --color-sattva: #63b4d1;
            --color-rajas: #d96c47;
            --color-tamas: #5c527f;
            --color-karma: #bca06a;

            --border-radius: 8px;
            --transition-speed: 0.3s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--color-bg);
            color: var(--color-text);
            overflow: hidden;
            cursor: none; /* Hide default cursor */
        }
        
        /* --- Custom Cursor --- */
        .custom-cursor-active {
            cursor: none;
        }
        #cursor-container {
            position: fixed;
            left: 0;
            top: 0;
            pointer-events: none;
            z-index: 9999;
            transition: transform 0.1s ease-out;
        }
        #cursor-container .chakra-cursor {
            transition: all 0.2s ease;
            transform-origin: center center;
        }
        #cursor-container.active .chakra-cursor {
            transform: scale(1.5);
            filter: drop-shadow(0 0 5px var(--color-primary-glow));
        }
        @media (pointer: coarse) {
            body, .custom-cursor-active {
                cursor: auto;
            }
            #cursor-container {
                display: none;
            }
        }

        /* --- Animated Background & Overlays --- */
        #particle-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: radial-gradient(circle, rgba(224, 150, 88, 0.05) 1px, transparent 1px);
            background-size: 2rem 2rem;
            animation: pan-background 120s linear infinite;
            z-index: -2;
        }
        @keyframes pan-background {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }
        #vignette-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            box-shadow: inset 0 0 15vw 5vw var(--color-bg);
            pointer-events: none;
            z-index: -1;
        }
        
        /* --- Page Transitions --- */
        .page-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--color-bg);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .page-transition.active {
            opacity: 1;
            pointer-events: all;
        }
        .page-transition-mandala {
            width: 100px;
            height: 100px;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='50' cy='50' r='45' stroke='%23e09658' stroke-width='1' fill='none'/%3E%3Ccircle cx='50' cy='50' r='30' stroke='%23e09658' stroke-width='1' fill='none'/%3E%3Ccircle cx='50' cy='50' r='15' stroke='%23e09658' stroke-width='1' fill='none'/%3E%3Ccircle cx='50' cy='50' r='5' fill='%23e09658'/%3E%3C/svg%3E");
            animation: spin 2s linear infinite, pulse-glow 2s ease-in-out infinite;
        }

        /* --- Game Layout --- */
        .game-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 1rem 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(to bottom, rgba(10, 9, 8, 0.8) 0%, rgba(10, 9, 8, 0) 100%);
            z-index: 50;
        }
        .header-title {
            font-family: var(--font-title);
            font-size: 2.5rem;
            color: var(--color-primary);
            text-shadow: 0 0 10px var(--color-shadow);
        }
        .menu-toggle-button {
            position: absolute;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
        }
        .game-wrapper {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            padding: 8rem 2rem 2rem;
            height: 100vh;
        }
        .story-panel, .status-panel {
            background: rgba(26, 24, 23, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(224, 150, 88, 0.2);
            border-radius: var(--border-radius);
            padding: 2rem;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(224, 150, 88, 0.3); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--color-primary); }

        /* --- Story Panel --- */
        #story-text {
            font-size: 1.2rem;
            line-height: 1.8;
            margin-bottom: 2rem;
        }
        #story-text p { margin-bottom: 1.5rem; }
        .highlight-text {
            color: var(--color-primary-glow);
            font-weight: bold;
            text-shadow: 0 0 5px var(--color-shadow);
        }

        /* --- Choice Buttons --- */
        #choices-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .choice-button {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            background: transparent;
            border: none;
            border-image: linear-gradient(to right, transparent, rgba(224, 150, 88, 0.3), transparent) 1;
            border-bottom: 1px solid;
            color: var(--color-text);
            padding: 1.25rem 1rem;
            text-align: left;
            font-family: var(--font-body);
            font-size: 1.1rem;
            transition: all var(--transition-speed) ease;
            position: relative;
            overflow: hidden;
        }
        .choice-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(224, 150, 88, 0.2), transparent);
            transition: left var(--transition-speed) ease-in-out;
        }
        .choice-button:hover {
            color: var(--color-primary-glow);
            transform: scale(1.02);
            border-image: linear-gradient(to right, transparent, var(--color-primary), transparent) 1;
        }
        .choice-button:hover::before {
            left: 100%;
        }
        .choice-icon {
            font-size: 1.5rem;
            color: var(--color-primary);
            transition: transform var(--transition-speed) ease;
        }
        .choice-button:hover .choice-icon {
            transform: scale(1.2) rotate(-5deg);
        }
        .choice-button.choice-selected {
            background-color: rgba(224, 150, 88, 0.2);
            animation: pulse-glow 0.5s ease-out;
        }

        /* --- Status Panel --- */
        .status-panel {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .panel-section {
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(224, 150, 88, 0.1);
        }
        .panel-section:last-child { border-bottom: none; }
        .panel-title {
            font-family: var(--font-title);
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--color-primary);
            margin-bottom: 1rem;
            text-align: center;
        }
        .character-summary {
            text-align: center;
        }
        .character-symbol {
            width: 100px;
            height: 100px;
            margin: 0 auto 1rem;
            filter: drop-shadow(0 0 15px var(--color-shadow));
            animation: float 4s ease-in-out infinite;
        }
        .character-name {
            font-family: var(--font-title);
            font-size: 2.2rem;
            color: var(--color-primary-glow);
        }
        
        /* Stats Grid with Bars */
        .stats-grid {
            display: grid;
            gap: 1rem;
        }
        .stat-item {
            display: grid;
            grid-template-columns: 60px 1fr 30px;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }
        .stat-label { color: var(--color-text-muted); }
        .stat-value { text-align: right; font-weight: bold; }
        .stat-bar {
            height: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
            overflow: hidden;
        }
        .stat-bar > div {
            height: 100%;
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
        }
        .karma-bar > div { background: linear-gradient(90deg, var(--color-karma), #d9c69a); }
        .sattva-bar > div { background: linear-gradient(90deg, var(--color-sattva), #9fd2e4); }
        .rajas-bar > div { background: linear-gradient(90deg, var(--color-rajas), #f09b7c); }
        .tamas-bar > div { background: linear-gradient(90deg, var(--color-tamas), #8a80a8); }

        /* Element Display */
        .element-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            text-transform: capitalize;
        }
        .element-icon { font-size: 2.5rem; }
        .element-earth { color: #8c6a46; }
        .element-water { color: #5c8b9c; }
        .element-fire { color: #d96c47; }
        .element-air { color: #a9b7c0; }
        .element-ether { color: #8c6da6; }

        /* Inventory */
        #inventory-list {
            list-style: none;
            text-align: center;
            min-height: 50px;
        }
        .inventory-empty { color: var(--color-text-muted); font-style: italic; }

        /* --- Buttons --- */
        button {
            cursor: none; /* Use custom cursor */
        }
        .control-button, .menu-toggle-button, .menu-button {
            background: linear-gradient(to bottom, rgba(255,255,255,0.05), rgba(0,0,0,0.05));
            border: 1px solid rgba(224, 150, 88, 0.5);
            color: var(--color-text);
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            font-family: var(--font-title);
            font-size: 1rem;
            letter-spacing: 1px;
            transition: all var(--transition-speed) ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.1);
        }
        .control-button:hover, .menu-toggle-button:hover, .menu-button:hover {
            background-color: rgba(224, 150, 88, 0.1);
            color: var(--color-primary-glow);
            border-color: var(--color-primary);
            box-shadow: 0 0 15px 0 var(--color-shadow);
            transform: translateY(-2px);
        }
        .control-button { width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }

        /* --- Modal --- */
        .modal {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(10, 9, 8, 0.8);
            backdrop-filter: blur(5px);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: var(--color-surface);
            border: 1px solid var(--color-primary);
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            box-shadow: 0 0 50px rgba(0,0,0,0.7);
            animation: fadeInUp 0.5s ease-out;
        }
        .modal-header {
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(224, 150, 88, 0.3);
        }
        .modal-header h2 {
            font-family: var(--font-title);
            font-size: 2rem;
            color: var(--color-primary);
        }
        .close-modal {
            color: var(--color-text-muted);
            font-size: 2rem;
            transition: color 0.3s ease;
        }
        .close-modal:hover { color: var(--color-primary-glow); }
        .modal-body { padding: 1.5rem; }
        .menu-buttons { display: flex; flex-direction: column; gap: 1rem; }
        .menu-button { display: flex; align-items: center; gap: 1rem; width: 100%; }
        .menu-button i { color: var(--color-primary); min-width: 20px; }

        /* --- Notifications --- */
        #notification-container {
            position: fixed; bottom: 20px; right: 20px; z-index: 1000;
            display: flex; flex-direction: column; gap: 10px;
        }
        .notification {
            background: linear-gradient(135deg, var(--color-surface), #2a2725);
            border-left: 4px solid var(--color-primary);
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            transform: translateX(120%);
            opacity: 0;
            transition: transform 0.5s ease, opacity 0.5s ease;
            min-width: 300px;
        }
        .notification.show { transform: translateX(0); opacity: 1; }
        .notification.hide { transform: translateX(120%); opacity: 0; }
        .notification.success { border-left-color: var(--color-sattva); }
        .notification.error { border-left-color: var(--color-rajas); }
        .notification-content { display: flex; align-items: center; gap: 1rem; }
        .notification-icon { font-size: 1.5rem; }
        .notification.success .notification-icon { color: var(--color-sattva); }
        .notification.error .notification-icon { color: var(--color-rajas); }

        /* --- Animations --- */
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes pulse-glow { 0%, 100% { filter: drop-shadow(0 0 10px var(--color-shadow)); } 50% { filter: drop-shadow(0 0 20px var(--color-primary-glow)); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translate3d(0, 40px, 0); } to { opacity: 1; transform: translate3d(0, 0, 0); } }
        .text-fade-in { animation: fadeInUp 0.8s ease-out; }
        .text-fade-in-delay-1 { animation: fadeInUp 0.8s ease-out 0.4s; animation-fill-mode: backwards; }
        .karma-increase { animation: karma-flash-green 1s; }
        .karma-decrease { animation: karma-flash-red 1s; }
        @keyframes karma-flash-green { 50% { color: var(--color-sattva); transform: scale(1.2); } }
        @keyframes karma-flash-red { 50% { color: var(--color-rajas); transform: scale(1.2); } }

        /* --- Responsive Design --- */
        @media (max-width: 1024px) {
            .game-wrapper {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
                padding: 6rem 1rem 1rem;
            }
            .status-panel {
                grid-row: 1;
            }
            .story-panel {
                grid-row: 2;
            }
        }
        @media (max-width: 768px) {
            .header-title { font-size: 1.8rem; }
            .menu-toggle-button { right: 1rem; }
            .game-wrapper { gap: 1rem; }
            .story-panel, .status-panel { padding: 1.5rem; }
            #story-text { font-size: 1.1rem; }
            .choice-button { font-size: 1rem; padding: 1rem; gap: 1rem; }
        }

    </style>

<script>
        // Nakshatra data
        const nakshatraData = {
            1: { name: 'Ashwini', deity: 'Ashvins', symbol: "Horse's Head", shakti: 'To heal quickly', element: 'fire', gana: 'Deva', rulingPlanet: 'Ketu' },
            2: { name: 'Bharani', deity: 'Yama', symbol: 'Yoni', shakti: 'To renew and purify', element: 'earth', gana: 'Manushya', rulingPlanet: 'Venus' },
            3: { name: 'Krittika', deity: 'Agni', symbol: 'Knife or Spear', shakti: 'To burn illusion', element: 'fire', gana: 'Rakshasa', rulingPlanet: 'Sun' },
            4: { name: 'Rohini', deity: 'Brahma', symbol: 'Cart or Chariot', shakti: 'To make things grow', element: 'earth', gana: 'Manushya', rulingPlanet: 'Moon' },
            5: { name: 'Mrigashira', deity: 'Soma', symbol: "Deer's Head", shakti: 'To find fulfillment', element: 'air', gana: 'Deva', rulingPlanet: 'Mars' },
            6: { name: 'Ardra', deity: 'Rudra', symbol: 'Teardrop', shakti: 'To feel and act', element: 'water', gana: 'Manushya', rulingPlanet: 'Rahu' },
            7: { name: 'Punarvasu', deity: 'Aditi', symbol: 'Bow and Quiver', shakti: 'To regenerate and recover', element: 'air', gana: 'Deva', rulingPlanet: 'Jupiter' },
            8: { name: 'Pushya', deity: 'Brihaspati', symbol: "Cow's Udder", shakti: 'To create spiritual energy', element: 'water', gana: 'Deva', rulingPlanet: 'Saturn' },
            9: { name: 'Ashlesha', deity: 'Nagas', symbol: 'Serpent', shakti: 'To poison and heal', element: 'water', gana: 'Rakshasa', rulingPlanet: 'Mercury' },
            10: { name: 'Magha', deity: 'Pitrs', symbol: 'Royal Throne', shakti: 'To leave the body', element: 'fire', gana: 'Rakshasa', rulingPlanet: 'Ketu' },
            11: { name: 'Purva Phalguni', deity: 'Bhaga', symbol: 'Front Legs of Bed', shakti: 'To find love and enjoyment', element: 'fire', gana: 'Manushya', rulingPlanet: 'Venus' },
            12: { name: 'Uttara Phalguni', deity: 'Aryaman', symbol: 'Four Legs of Bed', shakti: 'To accumulate security', element: 'fire', gana: 'Manushya', rulingPlanet: 'Sun' },
            13: { name: 'Hasta', deity: 'Savitri', symbol: 'Hand or Fist', shakti: 'To manifest desires', element: 'earth', gana: 'Deva', rulingPlanet: 'Moon' },
            14: { name: 'Chitra', deity: 'Tvastar', symbol: 'Bright Jewel', shakti: 'To accumulate merit', element: 'air', gana: 'Rakshasa', rulingPlanet: 'Mars' },
            15: { name: 'Swati', deity: 'Vayu', symbol: 'Shoot of a Plant', shakti: 'To scatter like the wind', element: 'air', gana: 'Deva', rulingPlanet: 'Rahu' },
            16: { name: 'Vishakha', deity: 'Indra-Agni', symbol: 'Triumphal Archway', shakti: 'To achieve many things', element: 'fire', gana: 'Rakshasa', rulingPlanet: 'Jupiter' },
            17: { name: 'Anuradha', deity: 'Mitra', symbol: 'Lotus Flower', shakti: 'To worship (Bhakti)', element: 'earth', gana: 'Deva', rulingPlanet: 'Saturn' },
            18: { name: 'Jyeshtha', deity: 'Indra', symbol: 'Umbrella', shakti: 'To rise and conquer', element: 'earth', gana: 'Rakshasa', rulingPlanet: 'Mercury' },
            19: { name: 'Mula', deity: 'Nirriti', symbol: 'Tied Bundle of Roots', shakti: 'To ruin or destroy', element: 'water', gana: 'Rakshasa', rulingPlanet: 'Ketu' },
            20: { name: 'Purva Ashadha', deity: 'Apas (Water)', symbol: 'Fan', shakti: 'To invigorate or strengthen', element: 'water', gana: 'Manushya', rulingPlanet: 'Venus' },
            21: { name: 'Uttara Ashadha', deity: 'Visvedevas', symbol: 'Elephant Tusk', shakti: 'To win for the highest good', element: 'earth', gana: 'Manushya', rulingPlanet: 'Sun' },
            22: { name: 'Shravana', deity: 'Vishnu', symbol: 'Ear', shakti: 'To connect', element: 'air', gana: 'Deva', rulingPlanet: 'Moon' },
            23: { name: 'Dhanishtha', deity: 'Vasus', symbol: 'Drum or Flute', shakti: 'To give fame and abundance', element: 'fire', gana: 'Rakshasa', rulingPlanet: 'Mars' },
            24: { name: 'Shatabhisha', deity: 'Varuna', symbol: 'Empty Circle', shakti: 'To heal and support', element: 'water', gana: 'Rakshasa', rulingPlanet: 'Rahu' },
            25: { name: 'Purva Bhadrapada', deity: 'Aja Ekapada', symbol: 'Two Front Legs of Cot', shakti: 'To raise a person up', element: 'fire', gana: 'Manushya', rulingPlanet: 'Jupiter' },
            26: { name: 'Uttara Bhadrapada', deity: 'Ahir Budhyana', symbol: 'Back Legs of Cot', shakti: 'To bring rain and stability', element: 'water', gana: 'Manushya', rulingPlanet: 'Saturn' },
            27: { name: 'Revati', deity: 'Pushan', symbol: 'Pair of Fish', shakti: 'To nourish and transcend', element: 'water', gana: 'Deva', rulingPlanet: 'Mercury' },
        };

        // Nakshatra symbol SVG paths
        const nakshatraSvgPaths = {
            1: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><path d="M30,30 Q50,10 70,30 Q80,50 70,70 Q50,90 30,70 Q20,50 30,30" stroke="#e09658" stroke-width="2" fill="none"/>',
            2: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><ellipse cx="50" cy="50" rx="20" ry="30" stroke="#e09658" stroke-width="2" fill="none"/>',
            3: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><line x1="30" y1="30" x2="70" y2="70" stroke="#e09658" stroke-width="2"/><line x1="30" y1="70" x2="70" y2="30" stroke="#e09658" stroke-width="2"/>',
            4: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><rect x="30" y="30" width="40" height="40" stroke="#e09658" stroke-width="2" fill="none"/>',
            5: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><path d="M30,50 Q50,20 70,50 Q50,80 30,50" stroke="#e09658" stroke-width="2" fill="none"/>',
            6: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><path d="M50,30 Q70,50 50,70 Q30,50 50,30" stroke="#e09658" stroke-width="2" fill="none"/>',
            7: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><path d="M30,50 L70,50 M50,30 L50,70" stroke="#e09658" stroke-width="2"/>',
            8: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><circle cx="50" cy="50" r="20" stroke="#e09658" stroke-width="2" fill="none"/>',
            9: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><path d="M30,70 Q50,30 70,70" stroke="#e09658" stroke-width="2" fill="none"/>',
            10: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><rect x="35" y="35" width="30" height="30" stroke="#e09658" stroke-width="2" fill="none"/>',
            11: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><line x1="30" y1="70" x2="70" y2="70" stroke="#e09658" stroke-width="2"/><line x1="30" y1="70" x2="30" y2="30" stroke="#e09658" stroke-width="2"/><line x1="70" y1="70" x2="70" y2="30" stroke="#e09658" stroke-width="2"/>',
            12: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><rect x="30" y="30" width="40" height="40" stroke="#e09658" stroke-width="2" fill="none"/>',
            13: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><path d="M30,50 L70,50 M30,40 L70,40 M30,60 L70,60" stroke="#e09658" stroke-width="2"/>',
            14: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><polygon points="50,20 60,40 80,40 65,55 70,75 50,65 30,75 35,55 20,40 40,40" stroke="#e09658" stroke-width="2" fill="none"/>',
            15: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><path d="M50,30 Q60,50 50,70" stroke="#e09658" stroke-width="2" fill="none"/>',
            16: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><path d="M30,70 L50,30 L70,70" stroke="#e09658" stroke-width="2" fill="none"/>',
            17: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><path d="M50,30 C70,40 70,60 50,70 C30,60 30,40 50,30" stroke="#e09658" stroke-width="2" fill="none"/>',
            18: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><path d="M40,30 L60,30 L60,70 L40,70 Z" stroke="#e09658" stroke-width="2" fill="none"/>',
            19: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><path d="M30,30 Q50,50 30,70 M70,30 Q50,50 70,70" stroke="#e09658" stroke-width="2" fill="none"/>',
            20: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><path d="M30,40 Q50,20 70,40 Q50,60 30,40" stroke="#e09658" stroke-width="2" fill="none"/>',
            21: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><path d="M40,30 C60,40 60,60 40,70" stroke="#e09658" stroke-width="2" fill="none"/>',
            22: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><path d="M30,50 C40,30 60,30 70,50 C60,70 40,70 30,50" stroke="#e09658" stroke-width="2" fill="none"/>',
            23: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><circle cx="50" cy="50" r="15" stroke="#e09658" stroke-width="2" fill="none"/>',
            24: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><circle cx="50" cy="50" r="20" stroke="#e09658" stroke-width="2" fill="none"/>',
            25: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><line x1="30" y1="70" x2="30" y2="30" stroke="#e09658" stroke-width="2"/><line x1="70" y1="70" x2="70" y2="30" stroke="#e09658" stroke-width="2"/>',
            26: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><line x1="30" y1="70" x2="70" y2="70" stroke="#e09658" stroke-width="2"/><line x1="30" y1="70" x2="30" y2="30" stroke="#e09658" stroke-width="2"/><line x1="70" y1="70" x2="70" y2="30" stroke="#e09658" stroke-width="2"/>',
            27: '<circle cx="50" cy="50" r="40" stroke="#e09658" stroke-width="2" fill="none"/><path d="M30,40 Q50,20 70,40 M30,60 Q50,80 70,60" stroke="#e09658" stroke-width="2" fill="none"/>',
        };

        // Element icons and animations
        const elementIcons = {
            earth: '<i class="fas fa-mountain element-earth-anim"></i>',
            water: '<i class="fas fa-water element-water-anim"></i>',
            fire: '<i class="fas fa-fire element-fire-anim"></i>',
            air: '<i class="fas fa-wind element-air-anim"></i>',
            ether: '<i class="fas fa-star element-ether-anim"></i>'
        };

        // Initialize the game
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const nakshatraNum = urlParams.get('nakshatra');
            const pada = urlParams.get('pada');
            const guna3 = urlParams.get('guna3');
            // Set up auto-save
            if (window.gameStateManager) {
                window.gameStateManager.setupAutoSave(60000); // Auto-save every minute
            }

            if (nakshatraNum && nakshatraData[nakshatraNum]) {
                const nakshatra = nakshatraData[nakshatraNum];
                
                // Update character information
                document.getElementById('character-name').textContent = nakshatra.name;
                document.getElementById('nakshatra-name').textContent = nakshatra.name;
                
                // Set character symbol
                const symbolSvg = document.getElementById('character-symbol-svg');
                symbolSvg.innerHTML = nakshatraSvgPaths[nakshatraNum] || '';
                
                // Set element display
                const elementDisplay = document.getElementById('element-display');
                elementDisplay.innerHTML = `
                    <div class="element-icon">${elementIcons[nakshatra.element]}</div>
                    <div class="element-name">${nakshatra.element.charAt(0).toUpperCase() + nakshatra.element.slice(1)}</div>
                `;
                elementDisplay.className = `element-display element-${nakshatra.element}`;
                
                // Set initial Guna values
                setGunaValues(nakshatraNum);
            }

            // Set up menu button
            document.getElementById('menu-button').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('game-menu-modal').style.display = 'flex';
            });

            // Set up close modal button
            document.querySelector('.close-modal').addEventListener('click', () => {
                document.getElementById('game-menu-modal').style.display = 'none';
            });

            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                const modal = document.getElementById('game-menu-modal');
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });

            // Set up menu buttons
            document.getElementById('character-profile-btn').addEventListener('click', () => {
                // Show page transition
                const transition = document.querySelector('.page-transition');
                transition.classList.add('active');
                
                // Navigate after animation
                setTimeout(() => {
                    window.location.href = `character-profile.html?${urlParams.toString()}`;
                }, 1000);
            });

            document.getElementById('exit-game-btn').addEventListener('click', () => {
                // Show page transition
                const transition = document.querySelector('.page-transition');
                transition.classList.add('active');
                
                // Navigate after animation
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);
            });

            document.getElementById('save-game-btn').addEventListener('click', () => {
                showNotification('Game saved successfully!', 'success');
                document.getElementById('game-menu-modal').style.display = 'none';
            });

            document.getElementById('new-game-btn').addEventListener('click', () => {
                // Show page transition
                const transition = document.querySelector('.page-transition');
                transition.classList.add('active');
                
                // Navigate after animation
                setTimeout(() => {
                    window.location.href = 'CB-fixed.html';
                }, 1000);
            });

            // Set up choice buttons
            const choiceButtons = document.querySelectorAll('.choice-button');
            choiceButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Add selection animation
                    button.classList.add('choice-selected');
                    
                    // Wait for animation to complete before proceeding
                    setTimeout(() => {
                        // Update story text
                        updateStory(button.querySelector('.choice-content').textContent);
                        
                        // Update karma (for demonstration)
                        updateKarma(1);
                    }, 500);
                });
            });
        });

        // Set guna values based on nakshatra number
        function setGunaValues(nakshatraNum) {
            let sattva = 0, rajas = 0, tamas = 0;
            
            // Simple algorithm to set guna values based on nakshatra number
            if (nakshatraNum >= 1 && nakshatraNum <= 9) {
                sattva = 1;
                rajas = 2;
                tamas = 0;
            } else if (nakshatraNum >= 10 && nakshatraNum <= 18) {
                sattva = 0;
                rajas = 1;
                tamas = 2;
            } else {
                sattva = 2;
                rajas = 0;
                tamas = 1;
            }
            
            // Update the UI
            document.getElementById('sattva-value').textContent = sattva;
            document.getElementById('rajas-value').textContent = rajas;
            document.getElementById('tamas-value').textContent = tamas;
        }

        // Update story text
        function updateStory(choiceText) {
            const storyText = document.getElementById('story-text');
            
            // Fade out current text
            storyText.classList.add('text-fade-out');
            
            setTimeout(() => {
                // Update text
                storyText.innerHTML = `
                    <p>You chose to ${choiceText.toLowerCase()}</p>
                    <p>As you proceed, the world around you begins to take shape, reflecting the essence of your inner nature.</p>
                    <p>Your journey has truly begun...</p>
                `;
                
                // Fade in new text
                storyText.classList.remove('text-fade-out');
                storyText.classList.add('text-fade-in');
                
                // Update choices
                updateChoices();
            }, 500);
        }

        // Update choices
        function updateChoices() {
            const choicesContainer = document.getElementById('choices-container');
            
            // Fade out current choices
            choicesContainer.classList.add('text-fade-out');
            
            setTimeout(() => {
                // Update choices
                choicesContainer.innerHTML = `
                    <button class="choice-button">
                        <div class="choice-icon"><i class="fas fa-map-signs"></i></div>
                        <div class="choice-content">Follow the path that leads toward the distant mountains.</div>
                    </button>
                    <button class="choice-button">
                        <div class="choice-icon"><i class="fas fa-tree"></i></div>
                        <div class="choice-content">Enter the forest to your right, which seems to whisper ancient secrets.</div>
                    </button>
                    <button class="choice-button">
                        <div class="choice-icon"><i class="fas fa-home"></i></div>
                        <div class="choice-content">Approach the small dwelling you notice in the distance.</div>
                    </button>
                `;
                
                // Fade in new choices
                choicesContainer.classList.remove('text-fade-out');
                choicesContainer.classList.add('text-fade-in');
                
                // Add event listeners to new buttons
                const newChoiceButtons = document.querySelectorAll('.choice-button');
                newChoiceButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        // Add selection animation
                        button.classList.add('choice-selected');
                        
                        // Wait for animation to complete before proceeding
                        setTimeout(() => {
                            // Update story text
                            updateStory(button.querySelector('.choice-content').textContent);
                            
                            // Update karma (for demonstration)
                            updateKarma(1);
                        }, 500);
                    });
                });
            }, 500);
        }

        // Update karma
        function updateKarma(amount) {
            const karmaValue = document.getElementById('karma-value');
            const currentKarma = parseInt(karmaValue.textContent);
            const newKarma = currentKarma + amount;
            
            // Add animation class
            karmaValue.classList.add(amount > 0 ? 'karma-increase' : 'karma-decrease');
            
            // Update value
            setTimeout(() => {
                karmaValue.textContent = newKarma;
                
                // Remove animation class
                setTimeout(() => {
                    karmaValue.classList.remove('karma-increase', 'karma-decrease');
                }, 1000);
            }, 500);
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <div class="notification-icon">
                        <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                    </div>
                    <div class="notification-message">${message}</div>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // Hide and remove notification after delay
            setTimeout(() => {
                notification.classList.remove('show');
                notification.classList.add('hide');
                
                setTimeout(() => {
                    container.removeChild(notification);
                }, 500);
            }, 3000);
        }

        // Custom cursor functionality
        document.addEventListener('DOMContentLoaded', () => {
            // Check if the device has a fine pointer (e.g., a mouse)
            if (window.matchMedia('(pointer: fine)').matches) {
                document.body.classList.add('custom-cursor-active');

                const cursorContainer = document.getElementById('cursor-container');

                document.addEventListener('mousemove', (e) => {
                    if (cursorContainer) {
                        cursorContainer.style.left = e.clientX + 'px';
                        cursorContainer.style.top = e.clientY + 'px';
                    }
                });

                document.addEventListener('mouseover', (e) => {
                    if (e.target.matches('a, button, .choice-button, .nav-link, .close-modal, .menu-button') || 
                        e.target.closest('a, button, .choice-button, .nav-link, .close-modal, .menu-button')) {
                        if (cursorContainer) {
                            cursorContainer.classList.add('active');
                        }
                    }
                });

                document.addEventListener('mouseout', (e) => {
                    if (e.target.matches('a, button, .choice-button, .nav-link, .close-modal, .menu-button') || 
                        e.target.closest('a, button, .choice-button, .nav-link, .close-modal, .menu-button')) {
                        if (cursorContainer) {
                            cursorContainer.classList.remove('active');
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>
